receivers:
  tracesimulationreceiver:
    global:
      interval: 5s
    blueprint:
      type: service
      service:
        default:
          delay:
            for: "0.1"
            as: relative
          duration:
            for: "0.8"
            as: relative
        services:
          - name: client
            resource:
              service.version: 1.0.0
            tasks:
              - name: send_request
                id: send_request
                delay:
                  for: 0s
                  as: absolute
                duration:
                  for: 2s
                  as: absolute
                kind: client
                attributes:
                  team: mobile
          - name: server
            resource:
              service.version: 1.1.0
            tasks:
              - name: accept_request
                childOf: send_request
                kind: server
                events:
                  - name: request_received
                    delay:
                      for: 0s
                      as: absolute
                    attributes:
                      http.method: GET
                      http.target: /api/v1/resource
                  - name: response_sent
                    delay:
                      for: "1.0"
                      as: relative
                    attributes:
                      http.method: GET
                      http.target: /api/v1/resource
                      http.status_code: "200"
                children:
                  - name: produce_message_event
                    id: produce_message_event
                    kind: producer
                    duration:
                      for: "0.3"
                    attributes:
                      team: backend
                      messaging.system: kafka
                      messaging.destination: message-topic
                      messaging.operation: publish
          - name: consumer
            resource:
              service.version: 1.2.0
            tasks:
              - name: consume_message_event
                delay:
                  for: 1s
                  as: absolute
                duration:
                  for: 200ms
                  as: absolute
                kind: consumer
                attributes:
                  team: backend
                  messaging.system: kafka
                  messaging.destination: message-topic
                  messaging.operation: consume
                linkedTo:
                  - produce_message_event
                children:
                  - name: process_message_event
                    kind: internal
                    conditionalEffects:
                      - condition:
                          kind: probabilistic
                          probabilistic:
                            threshold: 0.2
                        effects:
                          - kind: markAsFailed
                            markAsFailed:
                              message: Invalid message
                          - kind: annotate
                            annotate:
                              attributes:
                                error.type: InternalError

exporters:
  otlp/jaeger:
    endpoint: host.docker.internal:4317
    tls:
      insecure: true

service:
  pipelines:
    traces:
      receivers: [ tracesimulationreceiver ]
      processors: [ ]
      exporters: [ otlp/jaeger ]